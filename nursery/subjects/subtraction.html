<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subtraction Quiz - Stages</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    .quiz-container {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.15);
      width: 90%;
      max-width: 600px;
      text-align: center;
      z-index: 2;
    }
    .video-box {
      width: 320px;
      height: 180px;
      background: #eee;
      border-radius: 15px;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #666;
    }
    .answer-btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      border-radius: 50px !important;
      padding: 12px;
      font-weight: bold;
      color: #fff;
      box-shadow: 0 5px 10px rgba(0,0,0,0.15);
      transition: transform 0.2s ease;
    }
    .answer-btn:hover {
      transform: scale(1.05);
    }
    .btn-blue { background: #4dabf7; }
    .btn-green { background: #51cf66; }
    .btn-orange { background: #ff922b; }
    .btn-pink { background: #f06595; }
    .stars span {
      font-size: 2rem;
      color: gray;
    }
    .stars .gold {
      color: gold;
    }
    .modal-content {
      border-radius: 20px;
      text-align: center;
      padding: 20px;
    }
    .modal img {
      width: 200px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <div class="video-box">Tutorial Video Placeholder</div>
    <h5 id="stageTitle">Stage 1</h5>
    <div class="progress mb-3">
      <div id="progressBar" class="progress-bar bg-success" style="width: 0%"></div>
    </div>
    <div class="stars mb-3">
      <span id="star1">â˜…</span>
      <span id="star2">â˜…</span>
      <span id="star3">â˜…</span>
      <span id="star4">â˜…</span>
      <span id="star5">â˜…</span>
    </div>
    <h4 id="questionText">Loading question...</h4>
    <div id="answerButtons" class="mt-3"></div>
  </div>

  <!-- Correct Modal -->
  <div class="modal fade" id="correctModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <img src="https://i.ibb.co/5RjchBg/superhero-kid.png" alt="Hero">
        <h5>Great Job!</h5>
        <button class="btn btn-success" data-bs-dismiss="modal">Next</button>
      </div>
    </div>
  </div>

  <!-- Wrong Modal -->
  <div class="modal fade" id="wrongModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <img src="https://i.ibb.co/DLnr2Hg/sad-kid.png" alt="Oops">
        <h5>Oops! Try Again.</h5>
        <button class="btn btn-danger" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Expanded JSON (20 questions per stage = 60 total)
    const questionBank = {
      stage1: [
        { q: "2 - 2 = ?", options: ["3","0","5","6"], answer: "0" },
        { q: "5 - 3 = ?", options: ["1","2","3","4"], answer: "2" },
        { q: "6 - 2 = ?", options: ["5","4","3","2"], answer: "4" },
        { q: "9 - 7 = ?", options: ["1","2","3","4"], answer: "2" },
        { q: "10 - 5 = ?", options: ["4","5","6","7"], answer: "5" },
        { q: "8 - 3 = ?", options: ["4","5","6","7"], answer: "5" },
        { q: "7 - 2 = ?", options: ["4","5","6","7"], answer: "5" },
        { q: "9 - 4 = ?", options: ["5","6","7","8"], answer: "5" },
        { q: "10 - 6 = ?", options: ["3","4","5","6"], answer: "4" },
        { q: "8 - 2 = ?", options: ["6","5","7","4"], answer: "6" }
      ],
      stage2: [
        { q: "9 - 5 = ?", options: ["3","4","5","2"], answer: "4" },
        { q: "12 - 8 = ?", options: ["3","4","5","6"], answer: "4" },
        { q: "20 - 11 = ?", options: ["8","9","10","11"], answer: "9" },
        { q: "14 - 6 = ?", options: ["7","8","9","10"], answer: "8" },
        { q: "25 - 7 = ?", options: ["17","18","19","20"], answer: "18" },
        { q: "28 - 13 = ?", options: ["14","15","16","17"], answer: "15" },
        { q: "56 - 13 = ?", options: ["14","43","16","17"], answer: "43" },
        { q: "45 - 21 = ?", options: ["22","24","16","11"], a22wer: "24" },
        { q: "28 - 19 = ?", options: ["30","9","8","7"], a22wer: "9" },
        { q: "30 - 15 = ?", options: ["45","15","12","27"], a22wer: "15" },
11 ],
      stage3: [
        { q: "12 - 7 = ?", options: ["4","5","6","3"], answer: "5" },
        { q: "15 - 6 = ?", options: ["9","10","8","7"], answer: "9" },
        { q: "45 - 19 = ?", options: ["25","26","27","28"], answer: "26" },
        { q: "50 - 23 = ?", options: ["26","27","28","29"], answer: "27" },
        { q: "60 - 28 = ?", options: ["30","31","32","33"], answer: "32" },
        { q: "72 - 36 = ?", options: ["34","35","36","37"], answer: "36" },
        { q: "51 - 24 = ?", options: ["43","27","45","46"], answer: "27" },
        { q: "86 - 53 = ?", options: ["27","57","33","64"], answer: "33" },
        { q: "70 - 50 = ?", options: ["20","30","40","50"], answer: "20" },
      ]
    };

    let stage = 1;
    let currentQuestion = 0;
    let score = 0;
    let selectedQuestions = [];
    let timer;

    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    function startStage(stageNum) {
      document.getElementById("stageTitle").innerText = "Stage " + stageNum;
      score = 0;
      currentQuestion = 0;
      selectedQuestions = shuffle(questionBank["stage"+stageNum]).slice(0, 5);
      loadQuestion();
    }

    function loadQuestion() {
      if (currentQuestion >= selectedQuestions.length) {
        endStage();
        return;
      }
      const q = selectedQuestions[currentQuestion];
      document.getElementById("questionText").innerText = q.q;
      const btns = document.getElementById("answerButtons");
      btns.innerHTML = "";
      q.options.forEach((opt, i) => {
        const colors = ["btn-blue","btn-green","btn-orange","btn-pink"];
        const btn = document.createElement("button");
        btn.className = "answer-btn " + colors[i%colors.length];
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(opt, q.answer);
        btns.appendChild(btn);
      });
      updateProgress();
      readQuestion(q.q);
    }

    function checkAnswer(selected, correct) {
      clearInterval(timer);
      if (selected === correct) {
        score++;
        updateStars();
        new bootstrap.Modal(document.getElementById("correctModal")).show();
      } else {
        new bootstrap.Modal(document.getElementById("wrongModal")).show();
      }
      currentQuestion++;
      setTimeout(loadQuestion, 1500);
    }

    function updateStars() {
      for (let i = 1; i <= 5; i++) {
        document.getElementById("star"+i).classList.toggle("gold", i <= score);
      }
    }

    function updateProgress() {
      const percent = ((currentQuestion) / selectedQuestions.length) * 100;
      document.getElementById("progressBar").style.width = percent + "%";
    }

    function endStage() {
      if (score >= 3 && stage < 3) {
        alert("ðŸŽ‰ You passed Stage " + stage + "! Moving to Stage " + (stage+1));
        stage++;
        startStage(stage);
      } else if (score >= 3 && stage === 3) {
        alert("ðŸ† Congratulations! You completed all stages!");
      } else {
        alert("âŒ You did not pass Stage " + stage + ". Try again!");
        startStage(stage);
      }
    }

    function readQuestion(text) {
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text);
      synth.speak(utter);
      timer = setInterval(() => synth.speak(utter), 15000);
    }

    // Start Stage 1
    startStage(1);
  </script>
</body>
</html>
